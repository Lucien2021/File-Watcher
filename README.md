# 文件监控自动同步工具

一个用于嵌入式开发的 Windows 系统托盘应用，可以实时监控指定的文件，当文件更新时自动复制到对应的测试目录。

## 功能特点

- ✅ 实时监控指定文件的变化
- ✅ 自动复制文件到目标目录
- ✅ 支持多个文件-目录映射
- ✅ 系统托盘后台运行
- ✅ 自动打开目标目录（可选）
- ✅ 日志记录所有操作
- ✅ 配置文件管理
- ✅ **支持直接粘贴 Windows 路径（自动处理反斜杠）**

## 安装要求

- Python 3.8 或更高版本
- Windows 操作系统

## 安装步骤

1. 安装 Python 依赖：

```bash
pip install -r requirements.txt
```

## 配置说明

编辑 `config.json` 文件，配置需要监控的文件和对应的目标目录。

**重要提示：** 现在支持直接粘贴 Windows 路径！您可以从文件属性中复制路径，直接粘贴到配置文件中，程序会自动处理反斜杠转义。

### 配置示例

```json
{
  "mappings": [
    {
      "source_file": "E:\\SVN_NEW\\38 SCW非标（支持进出水压力传感器)\\Software\\V12.38.XX\\目标文件\\STM32\\debug\\M1_V5.012.xx.hex",
      "target_dir": "E:\\SVN_NEW\\38 SCW非标（支持进出水压力传感器)\\Software\\目标文件\\STM32\\Debug",
      "open_dir": true
    }
  ],
  "settings": {
    "log_file": "sync_log.txt",
    "auto_start": false
  }
}
```

### 配置项说明

- **mappings**: 文件-目录映射列表
  - **source_file**: 源文件完整路径（需要监控的文件）
    - 可以直接粘贴 Windows 路径，如：`E:\SVN_NEW\...`
    - 也可以使用转义格式：`E:\\SVN_NEW\\...`
  - **target_dir**: 目标目录（文件将被复制到此目录）
  - **open_dir**: 是否在复制后自动打开目标目录（可选，默认为 false）

- **settings**: 全局设置
  - **log_file**: 日志文件路径（可选，默认为 "sync_log.txt"）
  - **auto_start**: 是否自动启动（可选，暂未实现）

## 使用方法

1. 编辑 `config.json`，添加需要监控的文件和对应的目标目录
   - **提示**：可以直接从文件属性复制路径粘贴到配置文件中
2. 运行程序：

```bash
python main.py
```

3. 程序将在系统托盘运行，自动监控配置的文件
4. 当文件更新时，会自动复制到目标目录
5. 如果配置了 `open_dir: true`，复制后会自动打开目标目录

## 系统托盘菜单

右键点击系统托盘图标，可以访问以下功能：

- **查看日志**: 打开日志文件查看操作记录
- **编辑配置**: 打开配置文件进行编辑
- **刷新配置**: 重新加载配置文件（需要先停止监控）
- **关于**: 显示程序信息
- **退出**: 停止监控并退出程序

## 注意事项

1. 确保源文件路径和目标目录路径正确
2. 程序会自动创建目标目录（如果不存在）
3. 如果目标目录中已存在同名文件，会被直接覆盖
4. 文件复制使用完整文件名匹配（区分大小写）
5. 如果源文件被锁定（如正在编译），程序会重试复制
6. **路径配置**：可以直接粘贴 Windows 路径，程序会自动处理

## 故障排除

### 文件没有被复制

1. 检查配置文件中的路径是否正确
2. 检查源文件目录是否存在
3. 查看日志文件了解详细错误信息
4. 确保有足够的文件系统权限

### 程序无法启动

1. 检查 Python 版本是否符合要求
2. 检查是否安装了所有依赖：`pip install -r requirements.txt`
3. 检查配置文件格式是否正确（JSON 格式）

### JSON 格式错误

如果遇到 JSON 格式错误：
- 确保路径字符串用双引号包围
- 程序会自动处理路径中的反斜杠，但如果有其他 JSON 语法错误，需要手动修复

## 开发说明

项目结构：

```
file-sync-monitor/
├── main.py                 # 主程序入口
├── file_monitor.py         # 文件监控核心逻辑
├── config_manager.py       # 配置文件管理（支持自动修复路径）
├── tray_app.py             # 系统托盘应用
├── config.json             # 配置文件
├── requirements.txt         # Python 依赖
└── README.md               # 使用说明
```

## 许可证

MIT License

